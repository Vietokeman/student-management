# üóÑÔ∏è H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG SQLite V√Ä DBeaver

## üìç T√¨m file Database SQLite

### Tr√™n Android Device/Emulator:

Database c·ªßa app ƒë∆∞·ª£c l∆∞u t·∫°i:
```
/data/data/com.example.prm392_student_management/databases/student_management.db
```

### C√°ch l·∫•y file database v·ªÅ m√°y:

**B∆∞·ªõc 1: Ch·∫°y app m·ªôt l·∫ßn**
```bash
flutter run
```

**B∆∞·ªõc 2: T√¨m ƒë∆∞·ªùng d·∫´n database**
Th√™m d√≤ng n√†y v√†o `database_helper.dart` (trong h√†m `_initDB`):
```dart
print('üìç Database path: $path');
```

**B∆∞·ªõc 3: Pull database t·ª´ device**
```bash
# Xem devices
flutter devices

# Pull database
adb pull /data/data/com.example.prm392_student_management/databases/student_management.db ./student_management.db

# Ho·∫∑c k√©o c·∫£ th∆∞ m·ª•c
adb pull /data/data/com.example.prm392_student_management/databases/ ./databases/
```

---

## üîß C√†i ƒë·∫∑t v√† S·ª≠ d·ª•ng DBeaver

### 1. M·ªü Database trong DBeaver

**B∆∞·ªõc 1: M·ªü DBeaver**
- B·∫°n ƒë√£ c√≥ DBeaver r·ªìi ‚úÖ

**B∆∞·ªõc 2: T·∫°o k·∫øt n·ªëi m·ªõi**
1. Click `Database` ‚Üí `New Database Connection`
2. Ch·ªçn `SQLite`
3. Click `Next`

**B∆∞·ªõc 3: C·∫•u h√¨nh**
- **Path:** Browse ƒë·∫øn file `student_management.db` (v·ª´a pull v·ªÅ)
- Ho·∫∑c: `D:\Ki7fpt\PRM\prm392_student_management\student_management.db`
- Click `Test Connection`
- Click `Finish`

**B∆∞·ªõc 4: M·ªü v√† xem**
- Double click v√†o database
- M·ªü `Schemas` ‚Üí `Tables`
- S·∫Ω th·∫•y 2 b·∫£ng: `Nganh` v√† `Sinhvien`

---

## üìä C·∫•u tr√∫c Database

### B·∫£ng 1: Nganh

```sql
CREATE TABLE Nganh (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    TenNganh TEXT NOT NULL,
    MoTa TEXT NOT NULL
);
```

**D·ªØ li·ªáu m·∫∑c ƒë·ªãnh:**
```sql
INSERT INTO Nganh (TenNganh, MoTa) VALUES
('C√¥ng ngh·ªá Ph·∫ßn m·ªÅm', 'Ng√†nh ƒë√†o t·∫°o k·ªπ s∆∞ ph·∫ßn m·ªÅm chuy√™n nghi·ªáp'),
('H·ªá th·ªëng Th√¥ng tin', 'Ng√†nh qu·∫£n l√Ω v√† ph√°t tri·ªÉn h·ªá th·ªëng th√¥ng tin'),
('Tr√≠ tu·ªá Nh√¢n t·∫°o', 'Ng√†nh nghi√™n c·ª©u v√† ·ª©ng d·ª•ng AI');
```

### B·∫£ng 2: Sinhvien

```sql
CREATE TABLE Sinhvien (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    Ten TEXT NOT NULL,
    NgaySinh TEXT NOT NULL,           -- ISO8601 format: 2003-01-15T00:00:00.000
    DiaChi TEXT NOT NULL,
    IdNganh INTEGER NOT NULL,
    Anh TEXT,                          -- ƒê∆∞·ªùng d·∫´n file ·∫£nh
    SoDienThoai TEXT,
    Email TEXT NOT NULL UNIQUE,
    MatKhau TEXT NOT NULL,
    Role TEXT NOT NULL,                -- 'Admin' ho·∫∑c 'Sinhvien'
    Latitude REAL,                     -- GPS Latitude
    Longitude REAL,                    -- GPS Longitude
    FOREIGN KEY (IdNganh) REFERENCES Nganh(Id) ON DELETE CASCADE
);
```

**D·ªØ li·ªáu m·∫∑c ƒë·ªãnh (Admin):**
```sql
INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, Anh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('Administrator', '1990-01-01T00:00:00.000', 'FPT University', 1, NULL, '0123456789', 'admin@fpt.edu.vn', 'admin123', 'Admin', 10.8411, 106.8098);
```

---

## üî® Thao t√°c v·ªõi DBeaver

### 1. Xem d·ªØ li·ªáu (SELECT)

**C√°ch 1: Double click v√†o table**
- M·ªü b·∫£ng `Sinhvien` ‚Üí Click `Data`

**C√°ch 2: Vi·∫øt SQL**
```sql
-- Xem t·∫•t c·∫£ sinh vi√™n
SELECT * FROM Sinhvien;

-- Xem sinh vi√™n v·ªõi th√¥ng tin ng√†nh
SELECT 
    s.Id,
    s.Ten,
    s.Email,
    s.Role,
    n.TenNganh
FROM Sinhvien s
INNER JOIN Nganh n ON s.IdNganh = n.Id;

-- ƒê·∫øm s·ªë sinh vi√™n theo ng√†nh
SELECT 
    n.TenNganh,
    COUNT(s.Id) as SoSinhVien
FROM Nganh n
LEFT JOIN Sinhvien s ON n.Id = s.IdNganh
GROUP BY n.Id;
```

### 2. Th√™m d·ªØ li·ªáu (INSERT)

**Th√™m ng√†nh m·ªõi:**
```sql
INSERT INTO Nganh (TenNganh, MoTa) VALUES
('An ninh M·∫°ng', 'Ng√†nh b·∫£o m·∫≠t v√† an ninh th√¥ng tin');
```

**Th√™m sinh vi√™n m·ªõi:**
```sql
INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('Nguy·ªÖn VƒÉn A', '2003-05-15T00:00:00.000', 'H√† N·ªôi', 1, '0987654321', 'nguyenvana@fpt.edu.vn', '123456', 'Sinhvien', 21.0285, 105.8542);

INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('Tr·∫ßn Th·ªã B', '2003-08-20T00:00:00.000', 'H·ªì Ch√≠ Minh', 2, '0912345678', 'tranthib@fpt.edu.vn', '123456', 'Sinhvien', 10.7769, 106.7009);

INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('L√™ VƒÉn C', '2002-12-10T00:00:00.000', 'ƒê√† N·∫µng', 3, '0923456789', 'levanc@fpt.edu.vn', '123456', 'Sinhvien', 16.0544, 108.2022);
```

### 3. C·∫≠p nh·∫≠t d·ªØ li·ªáu (UPDATE)

```sql
-- C·∫≠p nh·∫≠t th√¥ng tin sinh vi√™n
UPDATE Sinhvien 
SET 
    Ten = 'Nguy·ªÖn VƒÉn An',
    SoDienThoai = '0999999999'
WHERE Id = 2;

-- C·∫≠p nh·∫≠t v·ªã tr√≠ GPS
UPDATE Sinhvien 
SET 
    Latitude = 10.8231,
    Longitude = 106.6297
WHERE Email = 'nguyenvana@fpt.edu.vn';

-- Thay ƒë·ªïi role
UPDATE Sinhvien 
SET Role = 'Admin'
WHERE Id = 2;
```

### 4. X√≥a d·ªØ li·ªáu (DELETE)

```sql
-- X√≥a sinh vi√™n theo ID
DELETE FROM Sinhvien WHERE Id = 3;

-- X√≥a sinh vi√™n theo email
DELETE FROM Sinhvien WHERE Email = 'test@fpt.edu.vn';

-- X√≥a t·∫•t c·∫£ sinh vi√™n (c·∫©n th·∫≠n!)
-- DELETE FROM Sinhvien;
```

### 5. T√¨m ki·∫øm (SEARCH)

```sql
-- T√¨m theo t√™n (c√≥ d·∫•u)
SELECT * FROM Sinhvien 
WHERE Ten LIKE '%Nguy·ªÖn%';

-- T√¨m theo email
SELECT * FROM Sinhvien 
WHERE Email LIKE '%@fpt.edu.vn';

-- T√¨m sinh vi√™n thu·ªôc ng√†nh c·ª• th·ªÉ
SELECT s.* FROM Sinhvien s
INNER JOIN Nganh n ON s.IdNganh = n.Id
WHERE n.TenNganh = 'C√¥ng ngh·ªá Ph·∫ßn m·ªÅm';

-- T√¨m admin
SELECT * FROM Sinhvien WHERE Role = 'Admin';
```

---

## üîÑ Workflow l√†m vi·ªác v·ªõi Database

### Quy tr√¨nh chu·∫©n:

```
1. Ch·∫°y app ‚Üí Database t·ª± ƒë·ªông t·∫°o
2. Pull database v·ªÅ m√°y (adb pull)
3. M·ªü trong DBeaver
4. Th√™m/S·ª≠a d·ªØ li·ªáu test
5. Push database l·∫°i l√™n device (adb push)
6. Kh·ªüi ƒë·ªông l·∫°i app
7. Test c√°c ch·ª©c nƒÉng
```

### L·ªánh chi ti·∫øt:

```bash
# B∆∞·ªõc 1: Pull database
adb pull /data/data/com.example.prm392_student_management/databases/student_management.db ./

# B∆∞·ªõc 2: Ch·ªânh s·ª≠a trong DBeaver
# (Th√™m data, test queries...)

# B∆∞·ªõc 3: Push l·∫°i l√™n device
adb push ./student_management.db /data/data/com.example.prm392_student_management/databases/

# B∆∞·ªõc 4: Kh·ªüi ƒë·ªông l·∫°i app
flutter run
```

---

## üìù SQL Scripts h·ªØu √≠ch

### Script 1: Reset Database (x√≥a t·∫•t c·∫£ data)

```sql
-- X√≥a t·∫•t c·∫£ sinh vi√™n
DELETE FROM Sinhvien;

-- X√≥a t·∫•t c·∫£ ng√†nh
DELETE FROM Nganh;

-- Reset auto increment
DELETE FROM sqlite_sequence WHERE name='Sinhvien';
DELETE FROM sqlite_sequence WHERE name='Nganh';
```

### Script 2: Seed Database (th√™m data m·∫´u)

```sql
-- Th√™m ng√†nh
INSERT INTO Nganh (TenNganh, MoTa) VALUES
('C√¥ng ngh·ªá Ph·∫ßn m·ªÅm', 'Ng√†nh ƒë√†o t·∫°o k·ªπ s∆∞ ph·∫ßn m·ªÅm chuy√™n nghi·ªáp'),
('H·ªá th·ªëng Th√¥ng tin', 'Ng√†nh qu·∫£n l√Ω v√† ph√°t tri·ªÉn h·ªá th·ªëng th√¥ng tin'),
('Tr√≠ tu·ªá Nh√¢n t·∫°o', 'Ng√†nh nghi√™n c·ª©u v√† ·ª©ng d·ª•ng AI'),
('An ninh M·∫°ng', 'Ng√†nh b·∫£o m·∫≠t v√† an ninh th√¥ng tin'),
('Khoa h·ªçc D·ªØ li·ªáu', 'Ng√†nh ph√¢n t√≠ch v√† x·ª≠ l√Ω d·ªØ li·ªáu l·ªõn');

-- Th√™m Admin
INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('Administrator', '1990-01-01T00:00:00.000', 'FPT University', 1, '0123456789', 'admin@fpt.edu.vn', 'admin123', 'Admin', 10.8411, 106.8098);

-- Th√™m sinh vi√™n m·∫´u
INSERT INTO Sinhvien (Ten, NgaySinh, DiaChi, IdNganh, SoDienThoai, Email, MatKhau, Role, Latitude, Longitude) VALUES
('Nguy·ªÖn VƒÉn Anh', '2003-01-15T00:00:00.000', '123 ƒê∆∞·ªùng ABC, H√† N·ªôi', 1, '0987654321', 'nguyenvananh@fpt.edu.vn', '123456', 'Sinhvien', 21.0285, 105.8542),
('Tr·∫ßn Th·ªã B√¨nh', '2003-05-20T00:00:00.000', '456 ƒê∆∞·ªùng XYZ, TP.HCM', 2, '0912345678', 'tranthibinh@fpt.edu.vn', '123456', 'Sinhvien', 10.7769, 106.7009),
('L√™ VƒÉn C∆∞·ªùng', '2002-11-10T00:00:00.000', '789 ƒê∆∞·ªùng MNO, ƒê√† N·∫µng', 3, '0923456789', 'levancuong@fpt.edu.vn', '123456', 'Sinhvien', 16.0544, 108.2022),
('Ph·∫°m Th·ªã Dung', '2003-03-25T00:00:00.000', '321 ƒê∆∞·ªùng PQR, H√† N·ªôi', 1, '0934567890', 'phamthidung@fpt.edu.vn', '123456', 'Sinhvien', 21.0245, 105.8412),
('Ho√†ng VƒÉn Em', '2003-07-18T00:00:00.000', '654 ƒê∆∞·ªùng STU, TP.HCM', 4, '0945678901', 'hoangvanem@fpt.edu.vn', '123456', 'Sinhvien', 10.8231, 106.6297);
```

### Script 3: Queries th·ªëng k√™

```sql
-- T·ªïng s·ªë sinh vi√™n
SELECT COUNT(*) as TongSV FROM Sinhvien WHERE Role = 'Sinhvien';

-- S·ªë l∆∞·ª£ng sinh vi√™n theo ng√†nh
SELECT 
    n.TenNganh,
    COUNT(s.Id) as SoLuong
FROM Nganh n
LEFT JOIN Sinhvien s ON n.Id = s.IdNganh AND s.Role = 'Sinhvien'
GROUP BY n.Id
ORDER BY SoLuong DESC;

-- Danh s√°ch sinh vi√™n c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin
SELECT 
    s.Ten,
    s.Email,
    s.SoDienThoai,
    n.TenNganh,
    CASE 
        WHEN s.Latitude IS NOT NULL THEN 'C√≥ v·ªã tr√≠'
        ELSE 'Ch∆∞a c√≥ v·ªã tr√≠'
    END as TrangThaiViTri,
    CASE 
        WHEN s.Anh IS NOT NULL THEN 'C√≥ ·∫£nh'
        ELSE 'Ch∆∞a c√≥ ·∫£nh'
    END as TrangThaiAnh
FROM Sinhvien s
INNER JOIN Nganh n ON s.IdNganh = n.Id
WHERE s.Role = 'Sinhvien';
```

---

## üéØ Tips & Best Practices

### 1. Backup Database

```bash
# Backup tr∆∞·ªõc khi thay ƒë·ªïi
adb pull /data/data/com.example.prm392_student_management/databases/student_management.db ./backup/student_management_backup_$(date +%Y%m%d).db
```

### 2. Export Data

Trong DBeaver:
- Right click v√†o table ‚Üí `Export Data`
- Ch·ªçn format: CSV, JSON, SQL, Excel...
- Ch·ªçn ƒë∆∞·ªùng d·∫´n l∆∞u

### 3. Import Data

Trong DBeaver:
- Right click v√†o table ‚Üí `Import Data`
- Ch·ªçn file (CSV, JSON, SQL...)
- Map columns ‚Üí Import

### 4. Ki·ªÉm tra Integrity

```sql
-- Ki·ªÉm tra Foreign Key
PRAGMA foreign_keys;

-- Ki·ªÉm tra integrity
PRAGMA integrity_check;

-- Xem c·∫•u tr√∫c b·∫£ng
PRAGMA table_info(Sinhvien);
PRAGMA table_info(Nganh);
```

### 5. Optimize Database

```sql
-- Vacuum (optimize size)
VACUUM;

-- Analyze (optimize queries)
ANALYZE;
```

---

## üêõ Troubleshooting

### L·ªói: "Database is locked"
```bash
# Stop app tr∆∞·ªõc khi pull/push
adb shell am force-stop com.example.prm392_student_management
```

### L·ªói: "Permission denied"
```bash
# Ch·∫°y v·ªõi root (n·∫øu c·∫ßn)
adb root
adb pull /data/data/...
```

### L·ªói: "File not found"
```bash
# Ki·ªÉm tra app ƒë√£ ch·∫°y ch∆∞a
flutter run

# List files
adb shell ls /data/data/com.example.prm392_student_management/databases/
```

---

## üìö T√†i li·ªáu tham kh·∫£o

- **SQLite Documentation:** https://www.sqlite.org/docs.html
- **DBeaver Documentation:** https://dbeaver.com/docs/
- **ADB Commands:** https://developer.android.com/studio/command-line/adb

---

## üí° L∆∞u √Ω quan tr·ªçng

1. ‚ö†Ô∏è **Lu√¥n backup** tr∆∞·ªõc khi thay ƒë·ªïi database
2. ‚ö†Ô∏è **Test tr√™n emulator** tr∆∞·ªõc khi test tr√™n device th·∫≠t
3. ‚ö†Ô∏è **ƒê√≥ng app** tr∆∞·ªõc khi pull/push database
4. ‚ö†Ô∏è **Ki·ªÉm tra Foreign Key** khi x√≥a ng√†nh (s·∫Ω x√≥a sinh vi√™n)
5. ‚ö†Ô∏è **Email ph·∫£i unique** - kh√¥ng tr√πng l·∫∑p

---

**Ch√∫c b·∫°n l√†m vi·ªác hi·ªáu qu·∫£ v·ªõi SQLite v√† DBeaver!** üéâ
